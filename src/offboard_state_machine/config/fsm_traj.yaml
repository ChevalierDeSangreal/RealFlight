# ==============================================================================
# 状态机配置文件 - Rate Control模式 (TRAJ模式)
# ==============================================================================
# 此配置用于hover_test任务（神经网络rate control）
# 
# 使用方法:
#   ros2 launch offboard_state_machine single_drone_test.launch.py \
#       config_file:=/path/to/fsm_traj.yaml
# ==============================================================================

/**:
  ros__parameters:
    # --------------------------------------------------------------------------
    # 无人机基本参数
    # --------------------------------------------------------------------------
    drone_id: 0
    num_drones: 1
    
    # --------------------------------------------------------------------------
    # 控制频率
    # --------------------------------------------------------------------------
    timer_period: 0.02  # 50 Hz (状态机控制循环频率)
    
    # --------------------------------------------------------------------------
    # 起飞参数
    # --------------------------------------------------------------------------
    takeoff_alt: 1.2      # 起飞高度 (米)
    takeoff_time: 10.0    # 起飞时间 (秒)
    climb_rate: 1.0       # 爬升速率 (米/秒，会被 takeoff_alt/takeoff_time 覆盖)
    alt_tol: 0.01         # 高度容差 (米)
    
    # --------------------------------------------------------------------------
    # GOTO 参数 (状态机自动飞向目标点)
    # --------------------------------------------------------------------------
    goto_x: 1.0           # GOTO 目标点 X (NED坐标系，米)
    goto_y: 0.0           # GOTO 目标点 Y (NED坐标系，米)
    goto_z: -1.2          # GOTO 目标点 Z (NED坐标系，负值表示高度)
    goto_tol: 0.05        # GOTO 到达容差 (米)
    goto_max_vel: 1.0     # GOTO 最大速度 (米/秒)
    goto_accel_time: 3.0  # GOTO 加速时间 (秒)
    
    # --------------------------------------------------------------------------
    # 降落参数
    # --------------------------------------------------------------------------
    landing_time: 2.0     # 降落时间 (秒)
    landing_max_vel: 0.3  # 降落最大速度 (米/秒)
    
    # --------------------------------------------------------------------------
    # TRAJ 状态控制模式 ⭐ 关键参数 ⭐
    # --------------------------------------------------------------------------
    # false: Rate control模式 - 外部节点发布VehicleRatesSetpoint (体轴角速率 + 推力)
    # true:  Position control模式 - 外部节点发布TrajectorySetpoint (位置 + 速度)
    traj_use_position_control: true
    
    # --------------------------------------------------------------------------
    # END_TRAJ 等待时间
    # --------------------------------------------------------------------------
    end_traj_wait_time: 5.0  # END_TRAJ状态悬停时间，之后自动降落 (秒)
    
    # --------------------------------------------------------------------------
    # 编队参数（单机时可忽略）
    # --------------------------------------------------------------------------
    inward_offset: 0.0     # 向内偏移 (米)
    payload_offset_x: 0.0  # 载荷偏移 X (米)
    payload_offset_y: 0.0  # 载荷偏移 Y (米)
    
    # --------------------------------------------------------------------------
    # 圆形轨迹参数（仅用于状态机内部生成轨迹，一般不使用）
    # --------------------------------------------------------------------------
    circle_radius: 1.4      # 圆形半径 (米)
    circle_radius_traj: 3.0 # 轨迹圆形半径 (米)
    circle_period: 20.0     # 圆周期 (秒)

# ==============================================================================
# 使用说明
# ==============================================================================
#
# 1. Rate Control模式（hover_test）工作流程：
#    a. 状态机完成起飞，进入HOVER状态
#    b. hover_test节点检测到HOVER状态，发送TRAJ命令
#    c. 状态机进入TRAJ状态，设置offboard_control_mode.body_rate = true
#    d. hover_test节点发布VehicleRatesSetpoint (体轴角速率 + 推力)
#    e. PX4以rate control模式执行控制指令
#    f. hover_test完成后发送END_TRAJ命令
#    g. 状态机进入END_TRAJ状态，等待后自动降落
#
# 2. 关键参数：
#    - traj_use_position_control: false  ← 使用rate control模式
#    - goto_z: -1.2                      ← 起飞后的悬停高度
#    - end_traj_wait_time: 5.0           ← 任务完成后悬停5秒再降落
#
# 3. 配合使用的节点：
#    - offboard_state_machine (此配置)
#    - hover_test (神经网络rate control节点)
#
# ==============================================================================

